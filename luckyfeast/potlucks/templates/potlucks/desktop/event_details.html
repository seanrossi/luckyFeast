{% include "potlucks/navbar.html" %}
{% load static %}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="{% static 'potlucks/main.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'potlucks/table-list.css' %}">
<div class="container-fluid" style="padding-top: 70px;">
<h1>{{ event.name }} Details</h1>
{% if request.user != event.host %}
<div class="table-list" >
<table style="border: blue solid 2px;">
<th>Going?</th>
{% if guest_instance.rsvp_status == 2 %}
<th>Dish</th>
{% endif %}
<tr>
<td>{{ guest_instance.get_rsvp_status_display }}</td>
{% if guest_instance.rsvp_status == 2 %}
<td>{{ guest_instance.assignment.dish_type }}</td>
{% endif %}
</tr>
</table>
</div>
{% endif %}
<br>
{% if event.host == request.user %} 
    <form action="{% url 'potlucks:event_cancel' %}" method="POST">
    {% csrf_token %}
    <input type="hidden" name="event_id" value="{{ event.pk }}" />
    <input type="submit" value="Cancel Event" />
    </form>
{% else %}

<form action="{% url 'potlucks:event_rsvp_change' %}" method="POST">
{% csrf_token %}
<input type="hidden" name="event_id" value="{{ event.pk }}" />
<input type="radio" name="rsvp" value="2" id="radioGoing" />Going</input>
<input type="radio" name="rsvp" value="3" id="notGoing" checked="checked" />Not Going</input>
<br><br>

{% endif %}

<!--DISPLAY EVENT PARAMETERS HERE-->
<div class="container">
<div class="row">
<div class="col-xs-4 col-sm-2">
<h3>Address</h3>
{{ event.address }}
</div>
<div class="col-xs-4 col-sm-2">
<h3>City</h3>
{{ event.city }}
</div>
<div class="col-xs-4 col-sm-2">
<h3>Zip</h3>
{{ event.zipcode }}
</div>
<div class="clearfix visible-xs"></div>
<div class="col-xs-6 col-sm-3">
<h3>Start</h3>
{{ event.start_time }}
</div>
<div class="col-xs-6 col-sm-3">
<h3>End</h3>
{{ event.end_time }}
</div>
</div>
</div>


<!--TABLE DISPLAY FOR DISH ASSIGNMENT LIST-->
<div class="row">
<div class="col-sm-6">
<div class="table-list" id="dish_table">
<h2>Dishes</h2>
<table>
    <tr><th>Dish Type</th><th>Assigned?</th></tr>
{% for dish in event.assignment_set.all %}
    <tr>
    <td>{{ dish.dish_type }}</td>
    <td>{% if dish.assignment_status %}
        Assigned
        {% else %}
        Unassigned
        {% endif %}
    </td>
    {% if event.host == request.user %} 
        <form action="{% url 'potlucks:event_remove_dish' %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="event_id" value="{{ event.pk }}" />
        <input type="hidden" name="dish_id" value="{{ dish.pk }}" />
        <td><input type="submit" value="Remove" /></td>
        </form>
    {% else %}
        <td><input type="radio" name="dish_id" class="dishRadio" value="{{ dish.pk }}" /></td>
    {% endif %}
    </tr>
{% endfor %}
</table>
{% if request.user != event.host %}
<input type="submit" value="Change RSVP/Dish" id="submitButton"/>
</form>
{% endif %}
{% if event.host == request.user %} 
    <form action="{% url 'potlucks:event_dishes' %}" method="POST">
    {% csrf_token %}
    <input type="hidden" name="event_id" value="{{ event.pk }}" />
    <input type="submit" value="Add Dish" />
{% endif %}
</form>
</div>
</div>

<!--TABLE DISPLAY FOR GUEST LIST-->
<div class="col-sm-6">
<div class="table-list" id="guest_table">
<h2>Guests</h2>
<table>
    <tr><th>Guest</th><th>Going?</th></tr>
{% for guest in event.guest_instance_set.all %}
    <tr>
    <td>{% if guest.guest %}{{ guest.guest.username }}{% else %}{{ guest.email }}{% endif %}</td>
    <td>{{ guest.get_rsvp_status_display }}</td>
    </tr>
{% endfor %}
</table>
{% if event.host == request.user %} 
    <form action="{% url 'potlucks:event_add_guests' %}" method="POST">
    {% csrf_token %}
    <input type="hidden" name="event_id" value="{{ event.pk }}" />
    <input type="submit" value="Add Guests" />
    </form>
{% endif %}
</div>
</div>
</div>
</div>

<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
<script>
  $(document).ready(function()
  {
    $("#radioGoing").change(function()
    {
      if( $("#radioGoing").is(':checked'))
      {
        $("#submitButton").prop('disabled', true);
      }
    });
    $("#notGoing").change(function()
    {
      if( $("#notGoing").is(':checked'))
      {
        $("#submitButton").prop('disabled', false);
      }
    });
    $(".dishRadio").change(function()
    {
      if( $(".dishRadio").is(':checked'))
      {
        $("#submitButton").prop('disabled', false);
      }
    });
  });
</script>
